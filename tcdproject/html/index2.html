<!DOCTYPE html>
<html>
<head>
	<title>Leaflet Quick Start Guide Example</title>
	<meta charset="utf-8" />

    <meta name="viewport"
          content="initial-scale = 1.333,
          minimum-scale = 1.333,
          maximum-scale = 1.333" />

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
	
</head>
<body>

	<div id="mapid" style="width:1700px; height:1100px"></div>
	<a href="index.html">book with me</a>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
	<script src="https://www.mapquestapi.com/sdk/leaflet/v2.s/mq-map.js?key=UShjaMayAC4UkuBJ5nu5rqFuraxzEOQU"></script>
	<script src="https://www.mapquestapi.com/sdk/leaflet/v2.s/mq-routing.js?key=UShjaMayAC4UkuBJ5nu5rqFuraxzEOQU"></script>
	<script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-traffic.js?key=UShjaMayAC4UkuBJ5nu5rqFuraxzEOQU"></script>
  	 <!-- qimessaging & jquery stuff -->
   	 <script src="js/jquery-1.11.0.min.js"></script>
   	 <script src="js/robotutils.js"></script>
   	 <!-- application script call -->



	<script>
	var mymap = L.map('mapid', {
    layers: MQ.mapLayer(),
    center: [ 37.7756988, -122.3935296 ],
    zoom: 16}).setView([37.7756988, -122.3935296], 16);
	mymap.panTo(L.latLng(37.7756988, -122.3935296));
	 $(document).ready(function(e){
            RobotUtils.onService(function (ALMemory) {
               ALMemory.getData('tcd/yelpDATA').then(function(value) {
                console.log(value);
		var obj = JSON.parse(value);
		console.log(obj[0].name);
		var count = obj.length;
		for (i = 0; i <count; i++){
			var lat = obj[i].lat;
			var lon = obj[i].long;
			L.marker([lat, lon]).addTo(mymap)
			.bindPopup(obj[i].name + "<br>" + obj[i].top_category+ "<br>" + obj[i].address).openPopup();
		}
		} )
		});
		})
		
	var dir;

	dir = MQ.routing.directions();

	dir.route({
	  locations: [
		'24 Willie Mays Plaza, San Francisco, CA',
		'600 The Embarcadero, San Francisco, CA'
	  ]
	});

	mymap.addLayer(MQ.routing.routeLayer({
	  directions: dir,
	  fitBounds: true
	}));

	MQ.trafficLayer().addTo(mymap);
               // log or display bla ...
				
	//	var dir = MQ.routing.directions();
  //                      { street: '', city: 'san francisco', state: 'dc' },
/*		dir.route({
 		 locations: [
		{latLng: { lat, lon }}, 
   	 { city: 'chicago', state: 'ca' }
 	 ]
		});	
		mymap.addLayer(MQ.routing.routeLayer({
		directions: dir,
		fitBounds: true
		})); */
		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
			id: 'mapbox.streets'
		}).addTo(mymap);

//		L.marker([lat, lon]).addTo(mymap)
//			.bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();
		
//		L.circle([51.508, -0.11], 500, {
//			color: 'red',
//			fillColor: '#f03',
//			fillOpacity: 0.5
//		}).addTo(mymap).bindPopup("I am a circle.");

//		L.polygon([
//			[51.509, -0.08],
//			[51.503, -0.06],
//			[51.51, -0.047]
//		]).addTo(mymap).bindPopup("I am a polygon.");


		var popup = L.popup();
		var clicklat;
		var clicklon;
		function onMapClick(e) {
			popup
				.setLatLng(e.latlng)
				.setContent("You clicked the map at " + e.latlng.toString())
				.openOn(mymap);
			clicklat = e.latlng.lat;
			clicklon = e.latlng.lng;
		//	L.marker([clicklat, clicklon]).addTo(mymap)
		//	.bindPopup("Here").openPopup();
		//	dir.route({
 		//	 locations: [
		//	{latLng: { lat, lon }}, 
   		//	 {latLng: {clicklat, clicklon} }
 		//	 ]
		//	});	
			console.log(clicklat);
		}
//		mymap.addLayer(MQ.routing.routeLayer({
//		directions: dir,
//		fitBounds: true
//			}));

//		mymap.on('click', onMapClick);
/*		dir.route({
			locations:[
			{ latLng: { lat, lon } },
			{city: 'san francisco', state: 'ca' }
			]
		});
		mymap.addLayer(MQ.routing.routeLayer({
		directions: dir,
		fitBounds: true
		}));*/
</script>
</body>
</html>

